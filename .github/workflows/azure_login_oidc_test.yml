name: Run Azure Login with OIDC(testing)
on: workflow_dispatch

permissions:
      id-token: write
      contents: write
jobs: 
  az-login-test:
    runs-on: self-hosted
    steps:
      - name: Check out repository
        uses: actions/checkout@v2
      - name: Installing CLI-beta for OIDC
        run: |
           echo "/Users/balaga-gayatri/oidc-venv/bin" >> $GITHUB_PATH
      - name: 'Az CLI login'
        uses: 'balaga-gayatri/login@oidc-support'
        with:
          client-id: eb27ed4a-c2a6-49e3-938e-5d159f36f1e5
          tenant-id: ${{ secrets.AZURE_TENANTID }}
          subscription-id: ${{ secrets.AZURE_SUBSCRIPTIONID }}
#           creds: ${{ secrets.AZURE_CHINA_GOV_CLOUD_CREDENTIALS}} 
#           allow-no-subscriptions: true
#           enable-AzPSSession: true
#           environment: azurechinacloud

      - name: Send mail
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          subject: Test mail please ignore
          to: balaga-gayatri@github.com
          from: Gayatri # <user@example.com>
          
      - run: |
          pwd
          az account show
          az group list
          pwd 
    
#${{ secrets.AZURE_CLIENTID }}
